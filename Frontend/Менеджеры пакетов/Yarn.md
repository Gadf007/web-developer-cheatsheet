# Yarn

- [Описание](#описание)
- [Установка](#установка)
- [Использование](#использование)
- [Сравнение Yarn и NPM](#сравнение-yarn-и-npm)
- [Полезные ссылки](#полезные-ссылки)

## Описание

**Yarn** — менеджер пакетов, совместно созданный Facebook, Google, Exponent и Tilde. Его целью является решение целого ряда проблем, с которыми столкнулись разработчики при использовании **npm**, а именно:

- Установка пакетов не была достаточно быстрой и последовательной
- Существовали проблемы с безопасностью, так как npm позволяет пакетам запускать код при установке

Yarn позволяет использовать и делиться кодом с другими разработчиками по всему миру. Yarn делает все быстро, защищенно, и надежно.




## Установка

```bash
# Ubuntu
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update
sudo apt-get install yarn
# macOS
brew install yarn
```



## Использование

```bash
# Начало нового проекта
yarn init
# Добавление зависимости
yarn add [package]
yarn add [package]@[version]
yarn add [package]@[tag]
# Добавление зависимостей к различным видам зависимостей (добавьте к группам `devDependencies`, `peerDependencies` и `optionalDependencies` соответствующие им зависимости)
yarn add [package] --dev
yarn add [package] --peer
yarn add [package] --optional
# Обновление зависимостей
yarn upgrade [package]
yarn upgrade [package]@[version]
yarn upgrade [package]@[tag]
# Удаление зависимостей
yarn remove [package]
# Установка всех зависимостей проекта
yarn install
```



## Сравнение Yarn и NPM

### Наличие `yarn.lock` файла

Управления версиями в файле `package.json` иногда становится беспорядочным. Файл `yarn.lock` помогает упорядочить эту путаницу. При добавлении новой зависимости, Yarn обновляет `yarn.lock` файл, принцип работы похож на `Gemfile.lock` в Ruby. `yarn.lock` файл гарантирует что на каждом устройстве будет установлена одинаковая версия пакета. `lock` файлы так называются, потому что они фиксируют версии зависимостей во время их установки. `lockfile` состоит из отсортированных ключей чтобы гарантировать минимальный изменения в файловой структуре папки `node_modules`.

В более ранних версиях npm, такая функциональность была реализована с помощью команды упаковывания(`npm shrinkwrap`). Тем не менее, `shrinkwrap` файл не генерировался автоматически, и требовал постоянной поддержки и обновления. Чтобы решить эту проблему npm ввел `package-lock.json`.

### Процесс установки пакетов

При установки пакета npm выполняет необходимые действия последовательно, в том смысле что каждый пакет должен полностью установится по очереди. Yarn в свою очередь производит несколько установок за один шаг, что делает процесс установки зависимостей менее длительным.

### Скорость

Yarn на порядок быстрее всех версий npm меньше 5.0. Когда команда npm выпустила 5 версию они заявили что она будет в пять раз быстрее своих предшественников. Но все же npm остался медленне чем Yarn.

### Безопасность

Главная проблема npm, это то что он автоматически запускает код зависимостей и позволяет добавлять зависимости на лету, хотя такие особенности дают много преимуществ, они также создаю уязвимости в безопасности. Так как Yarn устанавливает зависимости только с файлов `yarn.lock` или `package.json` он считается более безопасным. Также Yarn проверяет контрольные суммы перед установкой чтобы гарантировать целостность каждого пакета.

### Разница при выполнении команд

Кроме своих функциональных преимуществ, Yarn также имеет несколько новых полезных команд:

- **Установка зависимостей**. `npm install` устанавливает зависимости с файла `package.json`. Команда `yarn install` — с файла `yarn.lock`.
- `yarn why`. Если вам не понятно почему именно этот пакет установился, команда `yarn why` пройдется по графу зависимостей и поможет вам выяснить.
- **Добавления пакетов**. Команда `yarn add <package>` позволяет добавлять зависимости также как команда `npm install <package>`, но также добавляет зависимость в `package.json`.
- **Обновления пакетов**. Также как и `npm update`, команда `yarn upgrade [package]` обновляет версии пакетов до последних версий.
- `yarn generate-lock-entry`. Если вам нужно вручную сгенерировать файл `yarn.lock`, базируясь на зависимостях из `package.json`, используйте команду `yarn generate-lock-entry`. По сути это команда `npm shrinkwrap`, но ее нужно использовать очень аккуратно потому что файл `yarn.lock`, перезаписывается каждый раз при установке новой зависимости.



## Полезные ссылки

- [Документация](https://yarnpkg.com/ru/docs)
- [npm vs Yarn — какой менеджер пакетов стоит использовать?](https://ua-blog.com/npm-vs-yarn-%D0%BA%D0%B0%D0%BA%D0%BE%D0%B9-%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2-%D1%81%D1%82%D0%BE%D0%B8%D1%82-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB/)